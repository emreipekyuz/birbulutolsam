<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --primary-gradient: linear-gradient(90deg, #f77062 0%, #fe5196 100%); --text-dark: #333; }
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); background-size: 400% 400%; animation: gradient-animation 15s ease infinite; color: var(--text-dark); padding-top: 2rem; padding-bottom: 2rem; }
        .form-card { background: rgba(255, 255, 255, 0.85); border: none; border-radius: 20px; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); }
        .form-control, .form-select { background-color: rgba(255, 255, 255, 0.5); border: 1px solid rgba(0,0,0,0.1); color: var(--text-dark); border-radius: 10px; }
        .form-control:focus, .form-select:focus { background-color: #fff; border-color: #fe5196; box-shadow: 0 0 0 0.25rem rgba(254, 81, 150, 0.25); color: var(--text-dark); }
        .form-select option { background-color: #fff; color: var(--text-dark); }
        .form-check-input:checked { background-color: #e73c7e; border-color: #e73c7e; }
        .btn-primary { background: var(--primary-gradient); border: none; padding: 0.8rem; border-radius: 10px; font-weight: 700; color: white; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(231, 60, 126, 0.4); }
        #kvkkLink { cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
          <div class="form-card">
            <div class="card-body p-4 p-sm-5">
              <h2 class="card-title text-center fw-bold mb-3">☁️ Bir Bulut Olsam</h2>
              <p class="text-center text-secondary mb-4">Etkinlik Kayıt Formu</p>
              
              <form id="kayitFormu">
                <select id="etkinlik" class="form-select mb-3" required><option value="">Katılmak istediğin etkinliği seç...</option></select>
                <input type="text" class="form-control mb-3" id="ad" placeholder="Adın" required>
                <input type="text" class="form-control mb-3" id="soyad" placeholder="Soyadın" required>
                <input type="email" class="form-control mb-3" id="email" placeholder="E-posta adresin" required>
                
                <div class="input-group mb-3">
                  <span class="input-group-text">+90</span>
                  <input type="tel" class="form-control" id="telefon" placeholder="Telefon numaran" required pattern="[5][0-9]{9}" title="Lütfen 10 haneli telefon numaranızı girin (örn: 5551234567)">
                </div>
                
                <div class="form-check mb-4">
                  <input type="checkbox" class="form-check-input" id="kvkk" required>
                  <label class="form-check-label" for="kvkk" style="font-size: 0.8rem;">
                    <a id="kvkkLink" data-bs-toggle="modal" data-bs-target="#kvkkModal">KVKK aydınlatma metnini</a> okudum, anladım ve kabul ediyorum.
                  </label>
                </div>
                
                <div class="d-grid">
                  <button type="submit" class="btn btn-primary btn-lg">KAYIT OL</button>
                </div>
              </form>
              <div id="status" class="mt-3"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="kvkkModal" tabindex="-1" aria-labelledby="kvkkModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="kvkkModalLabel">BİR BULUT OLSAM DERNEĞİ ETKİNLİKLERİ</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
                <div class="modal-body">
                    </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button></div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const API_URL = "https://script.google.com/macros/s/AKfycbwE2GA2h4pczz4Kd-CJ0Rz_0nKWFY49CWzryEZu1p1GC-BpXRaDmCufPj1uLLwGUGL-/exec";

      // Sadece gerekli elementler tanımlandı
      const kayitFormu = document.getElementById("kayitFormu");
      const statusDiv = document.getElementById("status");

      function etkinlikListesiniDoldur(etkinlikListesi) {
        const select = document.getElementById("etkinlik");
        if (etkinlikListesi) {
          etkinlikListesi.forEach(etkinlik => {
            const option = document.createElement("option");
            option.value = etkinlik[0];
            option.text = etkinlik[1];
            select.appendChild(option);
          });
        }
      }

      function hataGoster(error) {
        statusDiv.innerHTML = `<div class="alert alert-danger">İletişim hatası: ${error.message}. Lütfen sayfayı yenileyin.</div>`;
      }
      
      window.onload = function() {
        fetch(API_URL + "?action=getEtkinlikler")
          .then(response => {
            if (!response.ok) throw new Error('API sunucusuna ulaşılamadı.');
            return response.json();
          })
          .then(result => {
            if (result.success) {
              etkinlikListesiniDoldur(result.data);
            } else { throw new Error(result.message); }
          })
          .catch(hataGoster);
      };

      // "Mevcut Kullanıcı" ile ilgili tüm JavaScript kodları kaldırıldı.

      kayitFormu.addEventListener("submit", e => {
        e.preventDefault();
        const formButton = kayitFormu.querySelector("button[type='submit']");
        const resetButton = () => {
            formButton.disabled = false;
            formButton.innerHTML = "KAYIT OL";
        };
        formButton.disabled = true;
        formButton.innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> KAYDEDİLİYOR...`;
        statusDiv.innerHTML = "";
        
        const formData = {
          etkinlik: document.getElementById("etkinlik").value,
          ad: document.getElementById("ad").value,
          soyad: document.getElementById("soyad").value,
          email: document.getElementById("email").value,
          telefon: "+90" + document.getElementById("telefon").value
        };
        
        fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'kayitEkle', formData: formData })
        })
        .then(response => {
            if (!response.ok) throw new Error('API sunucusuna ulaşılamadı.');
            return response.json();
        })
        .then(result => {
            if(result.success) {
                statusDiv.innerHTML = `<div class="alert alert-success">${result.message}</div>`;
                kayitFormu.reset();
            } else { throw new Error(result.message); }
            resetButton();
        })
        .catch(error => {
            hataGoster(error);
            resetButton();
        });
      });
    </script>
</body>
</html>
